<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Shell</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Shell</h1>
</header>
<h1 id="table-of-contents">Table of Contents <span class="tag" data-tag-name="TOC_3_gh"><span class="smallcaps">TOC_3_gh</span></span></h1>
<ul>
<li><a href="#reference">Reference</a>
<ul>
<li><a href="#builtins">Builtins</a>
<ul>
<li><a href="#command">command</a></li>
<li><a href="#declare">declare</a></li>
<li><a href="#export">export</a></li>
<li><a href="#readonly">readonly</a></li>
<li><a href="#set">set</a></li>
<li><a href="#trap">trap</a></li>
</ul></li>
<li><a href="#keywords">Keywords</a>
<ul>
<li><a href="#array">array</a></li>
<li><a href="#case">case</a></li>
<li><a href="#for">for</a></li>
<li><a href="#function">function</a></li>
<li><a href="#if">if</a></li>
</ul></li>
<li><a href="#others">Others</a>
<ul>
<li><a href="#special-parameters-----etc">Special Parameters ($#, $$, $*, $@, etc.)</a></li>
<li><a href="#-or-">$@ or $*</a></li>
<li><a href="#arithmetic-expansion">Arithmetic Expansion</a></li>
<li><a href="#brace-expansion">Brace Expansion</a></li>
<li><a href="#escaping-quotes">Escaping quotes</a></li>
<li><a href="#filename-expansion">Filename Expansion</a></li>
<li><a href="#here-document">Here document</a></li>
<li><a href="#here-strings">Here strings</a></li>
<li><a href="#history-expansion">History Expansion</a></li>
<li><a href="#process-substitution">Process Substitution</a></li>
<li><a href="#redirection">Redirection</a></li>
<li><a href="#shebang">Shebang</a></li>
<li><a href="#shell-parameter-expansion">Shell Parameter Expansion</a></li>
</ul></li>
</ul></li>
<li><a href="#topics">Topics</a>
<ul>
<li><a href="#subtlety-of-following-symlinks">Subtlety of Following Symlinks</a></li>
<li><a href="#usage-of-dash---in-place-of-a-filename-like-cat--">Usage of dash (-) in place of a filename, like 'cat -'</a></li>
</ul></li>
<li><a href="#how-to">How-to</a>
<ul>
<li><a href="#change-hostname">Change hostname</a></li>
<li><a href="#delete-all-broken-symbolic-links">Delete all broken symbolic links</a></li>
<li><a href="#delete-empty-directories-recursively">Delete empty directories recursively</a></li>
<li><a href="#empty-the-contents-of-a-file">Empty the contents of a file</a></li>
<li><a href="#force-exit-code-0-in-spite-of-error">Force exit code 0 in spite of error</a></li>
<li><a href="#get-the-source-directory">Get the source directory</a></li>
<li><a href="#glob-dotfiles">Glob dotfiles</a></li>
<li><a href="#pipe-stderr-and-not-stdout">Pipe stderr, and not stdout?</a></li>
<li><a href="#prevent-partially-downloaded-scripts-from-executing">Prevent partially downloaded scripts from executing</a></li>
<li><a href="#prompt-a-user-for-yesno">Prompt a user for yes/no</a></li>
<li><a href="#run-python-simple-web-server-for-sharing-files">Run python simple web server for sharing files</a></li>
<li><a href="#temporarily-move-to-a-different-working-directory-via-subshell">Temporarily move to a different working directory via subshell</a></li>
<li><a href="#test-whether-a-command-exists">Test whether a command exists</a></li>
<li><a href="#trim-a-variable">Trim a variable</a></li>
<li><a href="#use-command-output-as-a-file">Use command output as a file</a></li>
<li><a href="#useful-one-liners">Useful One-liners</a></li>
<li><a href="#wait-until-a-port-available">Wait until a port available</a></li>
<li><a href="#kill-all-background-processes-when-the-shell-script-exits">Kill all background processes when the shell script exits</a></li>
</ul></li>
<li><a href="#links">Links</a></li>
</ul>
<h1 id="reference">Reference</h1>
<h2 id="builtins">Builtins</h2>
<h3 id="command">command</h3>
<ul>
<li><a href="https://ss64.com/bash/command.html" class="uri">https://ss64.com/bash/command.html</a></li>
<li><a href="https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script" class="uri">https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script</a></li>
<li><a href="https://askubuntu.com/questions/512770/what-is-use-of-command-command" class="uri">https://askubuntu.com/questions/512770/what-is-use-of-command-command</a></li>
</ul>
<pre class="shell"><code># If there is a shell function named `ls&#39;, running `command ls&#39; within the function
# will execute the external `command ls&#39; instead of calling the function `ls&#39; recursively.
$ command ls

$ command -v &#39;curl&#39;
#          └─ print the pathname or command that will be used by the shell
/usr/bin/curl

$ command -v &#39;curl&#39; &gt;/dev/null 2&gt;&amp;1; echo &quot;$?&quot;
0

$ command -v &#39;carl&#39; &gt;/dev/null 2&gt;&amp;1; echo &quot;$?&quot;
1
</code></pre>
<h3 id="declare">declare</h3>
<dl>
<dt><code>-x</code></dt>
<dd>export
</dd>
</dl>
<p>—-</p>
<ul>
<li><a href="https://ss64.com/bash/declare.html" class="uri">https://ss64.com/bash/declare.html</a></li>
</ul>
<h3 id="export">export</h3>
<ul>
<li><a href="https://ss64.com/bash/export.html" class="uri">https://ss64.com/bash/export.html</a></li>
<li>Mark each <strong>name to be passed to child processes</strong> in the environment.</li>
<li>It doesn't matter whether you set a variable before <code>export</code> or vice versa.</li>
</ul>
<pre class="shell"><code>export [-fn] [-p] [name[=value]]
# -f   The names refer to shell functions
#      otherwise the names refer to shell variables
# -n   no longer mark each name for export
# -p   Display output in a form that can be reused as input.
</code></pre>
<h3 id="readonly">readonly</h3>
<ul>
<li><a href="https://bash.cyberciti.biz/guide/Readonly_command" class="uri">https://bash.cyberciti.biz/guide/Readonly_command</a></li>
<li><a href="https://ss64.com/bash/readonly.html" class="uri">https://ss64.com/bash/readonly.html</a></li>
</ul>
<pre class="shell"><code>readonly var
readonly var=value
readonly p=/tmp/toi.txt
# error
p=/tmp/newvale

readonly -f function_name
readonly -a array_name

readonly -p # print all readonly names
</code></pre>
<pre class="shell"><code>readonly VAR=foo   # POSIX
declare -r VAR=foo # bash
</code></pre>
<h3 id="set">set</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" class="uri">https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html</a></li>
<li><a href="https://github.com/jlevy/the-art-of-command-line" class="uri">https://github.com/jlevy/the-art-of-command-line</a></li>
</ul>
<pre class="shell"><code>set -e # Exit immediately when a command fails
set -x # Print a trace of simple commands

set +x # Use + rather than -  to turn off.

set -- &#39;foo&#39; &#39;bar&#39; # set the positional parameters
echo &quot;$1, $2&quot;      # &#39;foo, bar&#39;
</code></pre>
<pre class="shell"><code>set -euo pipefail
trap &quot;echo &#39;error: Script failed: see failed command above&#39;&quot; ERR
</code></pre>
<ul>
<li><code>-e</code> for errors</li>
<li><code>-u</code> for preventing unset</li>
<li><code>-o pipefail</code> for errors within pipes</li>
</ul>
<ol>
<li><p>set -x for a line</p>
<ul>
<li><a href="http://stackoverflow.com/questions/13195655/bash-set-x-without-it-being-printed" class="uri">http://stackoverflow.com/questions/13195655/bash-set-x-without-it-being-printed</a></li>
</ul>
<pre class="shell"><code>set -x
command
{ set +x; } 2&gt;/dev/null

# or simply
( set -x; command )
</code></pre></li>
</ol>
<h3 id="trap">trap</h3>
<pre class="shell"><code># signal
trap &#39;cmd&#39; SIGINT

# SIG prefix is optional
trap &#39;cmd&#39; INT

# special sigspec
trap &#39;cmd&#39; EXIT   # on exit
trap &#39;cmd&#39; DEBUG  # at every line
trap &#39;cmd&#39; ERR    # on error. &#39;set -e&#39; is more preferred
</code></pre>
<hr />
<ul>
<li><a href="https://ss64.com/bash/trap.html" class="uri">https://ss64.com/bash/trap.html</a></li>
</ul>
<h2 id="keywords">Keywords</h2>
<h3 id="array">array</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Arrays" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Arrays</a></li>
<li><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_10_02.html" class="uri">http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_10_02.html</a></li>
<li><a href="https://www.cyberciti.biz/faq/bash-iterate-array/" class="uri">https://www.cyberciti.biz/faq/bash-iterate-array/</a></li>
<li><p><a href="https://unix.stackexchange.com/questions/252368/is-there-a-reason-why-the-first-element-of-a-zsh-array-is-indexed-by-1-instead-o" class="uri">https://unix.stackexchange.com/questions/252368/is-there-a-reason-why-the-first-element-of-a-zsh-array-is-indexed-by-1-instead-o</a></p></li>
<li>Declare an array variable ::</li>
</ul>
<pre class="shell"><code>name[subscript]=value
declare -a nameo
declare -a name[subscript]  # &#39;subscript&#39; is ignored
name=(value1 value2 … )
</code></pre>
<dl>
<dt>Usage</dt>
<dd>
</dd>
</dl>
<pre class="shell"><code>$ array=(one two three)

$ echo &quot;${array[@]}&quot;
one two three

# NOTE: indexing starts at 0 in bash,
# but some other shells like zsh starts at 1,
# to be consistent with arugments indexing
$ echo &quot;${array[0]}&quot;
one

$ echo &quot;${array[2]}&quot;
three

$ array[3]=four

$ echo &quot;${array[@]}&quot;
one two three four

$ echo &quot;${#array[@]}&quot; # length
4

$ echo &quot;${!array[@]}&quot; # indexes
0 1 2 3

unset array[1] # delete an element

echo &quot;${array[@]}&quot;
one three four
</code></pre>
<ul>
<li>The difference between <code>${name[*]}</code> and <code>${name[@]}</code> is corresponds to <a href="#-vs-">$* vs $@</a></li>
<li>Bash empty array expansion with <code>set -u</code> may cause an error :: There are many <a href="https://stackoverflow.com/questions/7577052/bash-empty-array-expansion-with-set-u">workarounds</a>, but I think that it is the simplest to check empty before expansion</li>
</ul>
<pre class="shell"><code>arr=(one two three)
if [[ &quot;${#arr[@]}&quot; -gt 0 ]]; then
  for n in &quot;${arr[@]}&quot;; do
    echo &quot;$n&quot;
  done
fi
</code></pre>
<h3 id="case">case</h3>
<ul>
<li><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_03.html" class="uri">http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_03.html</a></li>
</ul>
<pre class="shell"><code>case &quot;$1&quot; in
  start)
    start
    ;;
  stop)
    stop
    ;;
  *)
    echo $&quot;Usage: $0 {start|stop}&quot;
    exit 1
    ;;
esac
</code></pre>
<h3 id="for">for</h3>
<ul>
<li><a href="https://www.cyberciti.biz/faq/bash-for-loop/" class="uri">https://www.cyberciti.biz/faq/bash-for-loop/</a></li>
<li><a href="https://google.github.io/styleguide/shell.xml?showone=Loops#Loops" class="uri">https://google.github.io/styleguide/shell.xml?showone=Loops#Loops</a></li>
</ul>
<ul>
<li>Put <code>; do</code> and <code>; then</code> on the same line as the <code>while</code>, <code>for</code> or <code>if</code>.</li>
<li>Use a for loop if you are confident that the input will not contain spaces or special characters (usually, this means not user input).</li>
</ul>
<pre class="shell"><code>for i in 1 2 3 4 5; do
  echo &quot;$i&quot;
done

for file in ~/repos/* ; do
  echo &quot;$file&quot;
done

# continue and break
for i in 1 2 3; do
  if [[ &quot;$i&quot; == 1 ]]; then
    continue
  fi
  if [[ &quot;$i&quot; == 3 ]]; then
    break
  fi
  echo &quot;$i&quot;
done

for (( i=1; i&lt;=5; i++)); do
  echo &quot;$i&quot;
done
</code></pre>
<pre class="shell"><code># requires bash v3.0+
for i in {1..5}; do
  echo &quot;$i&quot;
done

# requires bash v4.0+
for i in {0..10..2}; do
  echo &quot;$i&quot;
done
</code></pre>
<h3 id="function">function</h3>
<ul>
<li><a href="http://tldp.org/LDP/abs/html/functions.html" class="uri">http://tldp.org/LDP/abs/html/functions.html</a></li>
<li><a href="http://tldp.org/LDP/abs/html/complexfunct.html" class="uri">http://tldp.org/LDP/abs/html/complexfunct.html</a></li>
<li><a href="http://ryanstutorials.net/bash-scripting-tutorial/bash-functions.php" class="uri">http://ryanstutorials.net/bash-scripting-tutorial/bash-functions.php</a></li>
<li><a href="https://google.github.io/styleguide/shell.xml?showone=Function_Comments#Function_Comments" class="uri">https://google.github.io/styleguide/shell.xml?showone=Function_Comments#Function_Comments</a></li>
<li><a href="http://stackoverflow.com/questions/18042279/how-to-exit-a-function-in-bash" class="uri">http://stackoverflow.com/questions/18042279/how-to-exit-a-function-in-bash</a></li>
</ul>
<pre class="shell"><code>print_something() {
    echo Hello $1
}
print_something Mars
print_something Jupiter
</code></pre>
<ul>
<li>The keyword <code>function</code> is <strong>optional</strong>, but must be used consistently throughout a project.</li>
<li>If you're writing a package, separate package names with <code>::</code>.</li>
</ul>
<pre class="shell"><code># Single function
my_func() {
    ...
}

# Part of a package
mypackage::my_func() {
    ...
}
</code></pre>
<pre class="shell"><code>#######################################
# Cleanup files from the backup dir
# Globals:
#   BACKUP_DIR
#   ORACLE_SID
# Arguments:
#   None
# Returns:
#   None
#######################################
cleanup() {
    ...
}
</code></pre>
<pre class="shell"><code># If N is omitted, the return status is that of the
# last command executed within the function or script.
return [n]
</code></pre>
<blockquote>
<p>Note that if you have <code>set -e</code> set at the top of your script and your <code>return 1</code> or any other number besides <code>0</code>, your entire script will exit. <code>exit</code> abandons the current shell.</p>
</blockquote>
<ul>
<li>By <strong>default a variable is global.</strong></li>
<li>When we create a local variable within a function, <strong>it is only visible</strong> within that function.</li>
</ul>
<pre class="shell"><code>var_change () {
    local var1=&#39;local 1&#39;
    echo Inside function: var1 is $var1 : var2 is $var2
    var1=&#39;changed again&#39;
    var2=&#39;2 changed again&#39;
}
var1=&#39;global 1&#39;
var2=&#39;global 2&#39;
# only var2 changed
</code></pre>
<pre class="shell"><code>foo() {
  return 0 # return returns a value from a function.
}
bar() {
  exit 1 # exit abandons the current shell.
}

foo
echo &#39;hi&#39;
bar
echo &#39;bye&#39; # NOT printed
</code></pre>
<h3 id="if">if</h3>
<ul>
<li><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_01.html" class="uri">http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_01.html</a></li>
<li><a href="http://mywiki.wooledge.org/BashFAQ/031" class="uri">http://mywiki.wooledge.org/BashFAQ/031</a></li>
</ul>
<pre class="shell"><code>if commands; then
  commands
[elif commands; then
  commands ...]
[else
  commands]
fi
</code></pre>
<ul>
<li><code>[</code> and <code>test</code> are available in POSIX shells</li>
<li><code>[[</code> works only in Bash, Zsh and the Korn shell, and is more powerful</li>
<li><code>[[</code> is preferred over <code>[</code>, <code>test</code> (from <a href="https://google.github.io/styleguide/shell.xml">Google Shell Style Guide</a>)</li>
</ul>
<table>
<tbody>
<tr class="odd">
<td><code>[ -a FILE ]</code></td>
<td>True if FILE exists.</td>
</tr>
<tr class="even">
<td><code>[ -b FILE ]</code></td>
<td>True if FILE exists and is a block-special file.</td>
</tr>
<tr class="odd">
<td><code>[ -c FILE ]</code></td>
<td>True if FILE exists and is a character-special file.</td>
</tr>
<tr class="even">
<td><code>[ -d FILE ]</code></td>
<td>True if FILE exists and is a directory.</td>
</tr>
<tr class="odd">
<td><code>[ -e FILE ]</code></td>
<td>True if FILE exists.</td>
</tr>
<tr class="even">
<td><code>[ -f FILE ]</code></td>
<td>True if FILE exists and is a regular file.</td>
</tr>
<tr class="odd">
<td><code>[ -g FILE ]</code></td>
<td>True if FILE exists and its SGID bit is set.</td>
</tr>
<tr class="even">
<td><code>[ -h FILE ]</code></td>
<td>True if FILE exists and is a symbolic link.</td>
</tr>
<tr class="odd">
<td><code>[ -k FILE ]</code></td>
<td>True if FILE exists and its sticky bit is set.</td>
</tr>
<tr class="even">
<td><code>[ -p FILE ]</code></td>
<td>True if FILE exists and is a named pipe (FIFO).</td>
</tr>
<tr class="odd">
<td><code>[ -r FILE ]</code></td>
<td>True if FILE exists and is readable.</td>
</tr>
<tr class="even">
<td><code>[ -s FILE ]</code></td>
<td>True if FILE exists and has a size greater than zero.</td>
</tr>
<tr class="odd">
<td><code>[ -t FD ]</code></td>
<td>True if file descriptor FD is open and refers to a terminal.</td>
</tr>
<tr class="even">
<td><code>[ -u FILE ]</code></td>
<td>True if FILE exists and its SUID (set user ID) bit is set.</td>
</tr>
<tr class="odd">
<td><code>[ -w FILE ]</code></td>
<td>True if FILE exists and is writable.</td>
</tr>
<tr class="even">
<td><code>[ -x FILE ]</code></td>
<td>True if FILE exists and is executable.</td>
</tr>
<tr class="odd">
<td><code>[ -O FILE ]</code></td>
<td>True if FILE exists and is owned by the effective user ID.</td>
</tr>
<tr class="even">
<td><code>[ -G FILE ]</code></td>
<td>True if FILE exists and is owned by the effective group ID.</td>
</tr>
<tr class="odd">
<td><code>[ -L FILE ]</code></td>
<td>True if FILE exists and is a symbolic link.</td>
</tr>
<tr class="even">
<td><code>[ -N FILE ]</code></td>
<td>True if FILE exists and has been modified since it was last read.</td>
</tr>
<tr class="odd">
<td><code>[ -S FILE ]</code></td>
<td>True if FILE exists and is a socket.</td>
</tr>
<tr class="even">
<td><code>[ FILE1 -nt FILE2 ]</code></td>
<td>True if FILE1 is newer than FILE2, or if FILE1 exists and FILE2 does not.</td>
</tr>
<tr class="odd">
<td><code>[ FILE1 -ot FILE2 ]</code></td>
<td>True if FILE1 is older than FILE2, or is FILE2 exists and FILE1 does not.</td>
</tr>
<tr class="even">
<td><code>[ FILE1 -ef FILE2 ]</code></td>
<td>True if FILE1 and FILE2 refer to the same device and inode numbers.</td>
</tr>
<tr class="odd">
<td><code>[ -o OPTIONNAME ]</code></td>
<td>True if shell option &quot;OPTIONNAME&quot; is enabled.</td>
</tr>
<tr class="even">
<td><code>[ -z STRING ]</code></td>
<td>True of the length if &quot;STRING&quot; is zero.</td>
</tr>
<tr class="odd">
<td><code>[ -n STRING ]</code></td>
<td>True if the length of &quot;STRING&quot; is non-zero.</td>
</tr>
<tr class="even">
<td><code>[ STRING ]</code></td>
<td>True if the length of &quot;STRING&quot; is non-zero.</td>
</tr>
<tr class="odd">
<td><code>[ STRING1 == STRING2 ]</code></td>
<td>True if the strings are equal.</td>
</tr>
<tr class="even">
<td><code>[ STRING1 != STRING2 ]</code></td>
<td>True if the strings are not equal.</td>
</tr>
<tr class="odd">
<td><code>[ STRING1 &lt; STRING2 ]</code></td>
<td>True if &quot;STRING1&quot; sorts before &quot;STRING2&quot;</td>
</tr>
<tr class="even">
<td><code>[ STRING1 &gt; STRING2 ]</code></td>
<td>True if &quot;STRING1&quot; sorts after &quot;STRING2&quot;</td>
</tr>
<tr class="odd">
<td><code>[ ARG1 OP ARG2 ]</code></td>
<td>&quot;OP&quot; is one of <code>-eq</code>, <code>-ne</code>, <code>-lt</code>, <code>-le</code>, <code>-gt</code> or <code>-ge</code>.</td>
</tr>
</tbody>
</table>
<table>
<tbody>
<tr class="odd">
<td><code>[ ! EXPR ]</code></td>
<td>True if EXPR is false.</td>
</tr>
<tr class="even">
<td><code>[ ( EXPR ) ]</code></td>
<td>Returns the value of EXPR. To override the normal precedence of operators.</td>
</tr>
<tr class="odd">
<td><code>[ EXPR1 -a EXPR2 ]</code></td>
<td>True if both EXPR1 and EXPR2 are true.</td>
</tr>
<tr class="even">
<td><code>[ EXPR1 -o EXPR2 ]</code></td>
<td>True if either EXPR1 or EXPR2 is true.</td>
</tr>
</tbody>
</table>
<pre class="shell"><code>if [[ -z &quot;$foo&quot; ]] &amp;&amp; [[ -z &quot;$bar&quot; ]];
if [[ -z &quot;$foo&quot; &amp;&amp; -z &quot;$bar&quot; ]]; # equivalent to above
</code></pre>
<ul>
<li><a href="http://mywiki.wooledge.org/BashFAQ/031" class="uri">http://mywiki.wooledge.org/BashFAQ/031</a></li>
</ul>
<p><img src="_img/screenshot_2017-08-26_11-35-09.png" /></p>
<h2 id="others">Others</h2>
<h3 id="special-parameters-etc.--httpswww.gnu.orgsoftwarebashmanualhtml_nodespecial-parameters.html--positional-parameters--positional-parameters--number-of-positional-parameters--exit-status-of-the-most-recently-executed-foreground-pipeline.----current-option-flags-as-specified-upon-invocation-by-the-set--process-id-of-the-shell">Special Parameters ($#, <span class="math display">\[, $*, $@, etc.)
- https://www.gnu.org/software/bash/manual/html_node/Special-Parameters.html

- ~$*~ :: positional parameters
- ~$@~ :: positional parameters
- ~$#~ :: number of positional parameters
- ~$?~ :: exit status of the most recently executed foreground pipeline.
- ~$-~ :: current option flags as specified upon invocation, by the ~set~
- ~\]</span>~ :: process ID of the shell</h3>
<dl>
<dt><code>$!</code></dt>
<dd>process ID of the job most recently placed into the background
</dd>
<dt><code>$0</code></dt>
<dd>name of the shell or shell script.
</dd>
<dt><code>$_</code></dt>
<dd>?
</dd>
</dl>
<h3 id="or">$@ or $*</h3>
<ul>
<li><a href="http://stackoverflow.com/questions/12314451/accessing-bash-command-line-args-vs" class="uri">http://stackoverflow.com/questions/12314451/accessing-bash-command-line-args-vs</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Special-Parameters" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Special-Parameters</a></li>
<li>Use <code>​&quot;$@&quot;​</code> for most cases</li>
</ul>
<pre class="shell"><code>$ set -- &quot;arg  1&quot; &quot;arg  2&quot; &quot;arg  3&quot;

$ for word in $*; do echo &quot;$word&quot;; done
arg
1
arg
2
arg
3

$ for word in $@; do echo &quot;$word&quot;; done
arg
1
arg
2
arg
3

$ for word in &quot;$*&quot;; do echo &quot;$word&quot;; done
arg  1 arg  2 arg  3

$ for word in &quot;$@&quot;; do echo &quot;$word&quot;; done
arg  1
arg  2
arg  3
</code></pre>
<h3 id="arithmetic-expansion">Arithmetic Expansion</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Arithmetic-Expansion" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Arithmetic-Expansion</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Shell-Arithmetic" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Shell-Arithmetic</a></li>
</ul>
<pre class="shell"><code>$(( expression ))
</code></pre>
<h3 id="brace-expansion">Brace Expansion</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Brace-Expansion" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Brace-Expansion</a></li>
<li>Performed before any other expansions</li>
<li>Any characters special to other expansions are preserved in the result</li>
</ul>
<pre class="shell"><code>$ echo a{d,c,b}e
ade ace abe

$ mkdir /usr/local/src/bash/{old,new,dist,bugs}
$ chown root /usr/{ucb/{ex,edit},lib/{ex?.?*,how_ex}}
</code></pre>
<h3 id="escaping-quotes">Escaping quotes</h3>
<ol>
<li><p>Escaping double quotes</p>
<ul>
<li>Escape it with backslash</li>
</ul>
<pre class="example"><code>&quot;\&quot;&quot;
</code></pre>
<ul>
<li>Double quoted shell expansion is valid within double quotes</li>
</ul>
<pre class="shell"><code>$ echo &#39;echo $#&#39; &gt; arg-count
$ chmod +x arg-count
$ ./arg-count
0
$ echo &quot;$(./arg-count $(echo foo bar))&quot;
2
$ echo &quot;$(./arg-count &quot;$(echo foo bar)&quot;)&quot;
1
</code></pre></li>
<li><p>Escaping single quotes within a single quoted string</p>
<ul>
<li><a href="https://stackoverflow.com/questions/1250079/how-to-escape-single-quotes-within-single-quoted-strings" class="uri">https://stackoverflow.com/questions/1250079/how-to-escape-single-quotes-within-single-quoted-strings</a></li>
</ul>
<pre class="example"><code>alias rxvt=&#39;urxvt -fg &#39;&quot;&#39;&quot;&#39;#111111&#39;&quot;&#39;&quot;&#39; -bg &#39;&quot;&#39;&quot;&#39;#111111&#39;&quot;&#39;&quot;
#                     ^^^^^       ^^^^^     ^^^^^       ^^^^
#                     12345       12345     12345       1234

</code></pre>
<ol>
<li>' End first quotation which uses single quotes.</li>
<li>&quot; Start second quotation, using double-quotes.</li>
<li>' Quoted character.</li>
<li>&quot; End second quotation, using double-quotes.</li>
<li>' Start third quotation, using single quotes.</li>
</ol>
<p>Or, use ANSI C string:(<code>$''</code>). We can escape a single quote with <code>\'</code>. But in this way, we loses bash's literal meaning. Other meta character like <code>\n</code>, <code>\t</code> will also get a special meaning.</p>
<pre class="shell"><code>echo $&#39;Can\&#39;t do that&#39;
</code></pre></li>
</ol>
<h3 id="filename-expansion">Filename Expansion</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Filename-Expansion" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Filename-Expansion</a></li>
<li><code>*</code> :: Matches any string, including the null string.</li>
<li><code>**</code> :: Matches all files and zero or more directories and subdirectories.</li>
<li><code>**/</code> :: Matches all subdirectories.</li>
<li><code>?</code> :: Matches any single character.</li>
<li><code>[...]</code> :: Matches any one of the enclosed characters.</li>
</ul>
<h3 id="here-document">Here document</h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Here_document" class="uri">https://en.wikipedia.org/wiki/Here_document</a></li>
</ul>
<pre class="shell"><code>tr a-z A-Z &lt;&lt; END_TEXT
one two three
four five six
END_TEXT
</code></pre>
<pre class="example"><code>ONE TWO THREE
FOUR FIVE SIX
</code></pre>
<pre class="shell"><code># Ignore leading tabs
tr a-z A-Z &lt;&lt;- END_TEXT
         one two three
         four five six
         END_TEXT
</code></pre>
<pre class="example"><code>(Same as above)
</code></pre>
<pre class="shell"><code># Disable string interpolation
cat &lt;&lt; &#39;EOF&#39;
\$ Working dir &quot;$PWD&quot; `pwd`
EOF
</code></pre>
<pre class="example"><code>\$ Working dir &quot;$PWD&quot; `pwd`
</code></pre>
<ul>
<li>For redirections and pipelining:</li>
<li><a href="https://unix.stackexchange.com/questions/88490/how-do-you-use-output-redirection-in-combination-with-here-documents-and-cat" class="uri">https://unix.stackexchange.com/questions/88490/how-do-you-use-output-redirection-in-combination-with-here-documents-and-cat</a></li>
</ul>
<pre class="shell"><code>cat &lt;&lt;EOF | sh
touch somefile
echo foo &gt; somefile
EOF
</code></pre>
<pre class="shell"><code>(
cat &lt;&lt;EOF
touch somefile
echo foo &gt; somefile
EOF
) | sh
</code></pre>
<pre class="shell"><code>{
cat &lt;&lt;EOF
touch somefile
echo foo &gt; somefile
EOF
} | sh
</code></pre>
<pre class="shell"><code>cat &gt;out &lt;&lt;EOF
test
EOF
</code></pre>
<h3 id="here-strings">Here strings</h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Here_document#Here_strings" class="uri">https://en.wikipedia.org/wiki/Here_document#Here_strings</a></li>
<li>The key difference from here documents is that, in here documents, the delimiters are on separate lines;</li>
</ul>
<pre class="shell"><code>$ tr a-z A-Z &lt;&lt;&lt; one
ONE

$ FOO=&#39;one two three&#39;
$ tr a-z A-Z &lt;&lt;&lt; $FOO
ONE TWO THREE
</code></pre>
<ul>
<li>Here strings are particularly useful when the last command needs to run in the current process</li>
</ul>
<pre class="shell"><code>$ echo &#39;one two three&#39; | read a b c
$ echo $a $b $c
# yields nothing, because &#39;read&#39; ran on subshell

$ read a b c &lt;&lt;&lt; &#39;one two three&#39;
$ echo $a $b $c
one two three
</code></pre>
<h3 id="history-expansion">History Expansion</h3>
<ul>
<li><a href="http://www.thegeekstuff.com/2011/08/bash-history-expansion" class="uri">http://www.thegeekstuff.com/2011/08/bash-history-expansion</a></li>
</ul>
<pre class="shell"><code>$ history
1 tar cvf etc.tar /etc/
2 cp /etc/passwd /backup
3 ps -ef | grep http
4 service sshd restart
5 /usr/local/apache2/bin/apachectl restart

$ !4  # 4
service sshd restart

$ !-2  # 2 commands back
service sshd restart

$ !!   # last (1 command back)
$ !-1

$ !ps  # command that starts with &#39;ps&#39;
ps -ef | grep http

$ !?apache  # command that contains &#39;apache&#39;
/usr/local/apache2/bin/apachectl restart


$ ls /etc/cron.daily/logrotate

$ ^ls^cat^  # replace &#39;ls&#39; with &#39;cat&#39;
cat /etc/cron.daily/logrotate

$ cp /etc/passwd /backup

$ ls -l !cp:^  # first argument
ls -l /etc/passwd

$ cp /etc/passwd /backup

$ ls -l !cp:$  # last argument
ls -l /backup

$ ls -l !!:$  # last argument of last command
$ ls -l !$    # equivalent to above

$ ls -l !!:2  # second
$ ls -l !!:*  # all

$ !!:s/ls -l/cat/  # substitution

$ cp /etc/password /backup/password.bak
$ !!:gs/password/passwd/  # global substitution
cp /etc/passwd /backup/passwd.bak

$ ls -l !!:$:p  # print without executing it
</code></pre>
<h3 id="process-substitution">Process Substitution</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Process-Substitution" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Process-Substitution</a></li>
<li><a href="http://tldp.org/LDP/abs/html/process-sub.html" class="uri">http://tldp.org/LDP/abs/html/process-sub.html</a></li>
<li><p><a href="https://en.wikipedia.org/wiki/Process_substitution" class="uri">https://en.wikipedia.org/wiki/Process_substitution</a></p></li>
<li><p><code>&lt;(command)</code> :: Runs command and make its output appear as a file.</p></li>
</ul>
<pre class="shell"><code>$ diff &lt;(sort file1) &lt;(sort file2)
</code></pre>
<dl>
<dt><code>&gt;(command)</code></dt>
<dd>Captures output that would normally go to a file, and redirect it to the input of a process.
</dd>
</dl>
<pre class="shell"><code>$ cat foo | tee &gt;(tr &#39;[:lower:]&#39; &#39;[:upper:]&#39;)
hello, world  #    stdout of tee (original output)
HELLO, WORLD  # file part of tee (process substitution)
</code></pre>
<h3 id="redirection">Redirection</h3>
<ul>
<li><a href="http://tldp.org/LDP/abs/html/io-redirection.html" class="uri">http://tldp.org/LDP/abs/html/io-redirection.html</a></li>
</ul>
<pre class="shell"><code>$ : &gt; foo.txt  # truncate
$ &gt; foo.txt    # same as above, but some shells don&#39;t support

$ echo &#39;hi&#39; &gt; foo.txt   # stdout
$ echo &#39;hi&#39; &gt;&gt; foo.txt  # stdout, append

# fd 1 is stdout; same as above
$ echo &#39;hi&#39; 1&gt; foo.txt
$ echo &#39;hi&#39; 1&gt;&gt; foo.txt

# fd 2 is stderr (following commands will cause errors)
$ tar 2&gt; foo.txt
$ cp 2&gt;&gt; foo.txt

$ tar &amp;&gt; foo.txt  # both

# redirects stderr to stdout
# (M&gt;&amp;N redirects file descriptor M to file descriptor N, M is 1 if omitted)
$ tar &gt; out.txt 2&gt;&amp;1

# multiple redirections
$ command &lt; input-file &gt; output-file
</code></pre>
<pre class="shell"><code># &#39;[j]&lt;&gt;filename&#39;
# Open file &quot;filename&quot; for reading and writing, and assign file descriptor &quot;j&quot; to it.
# &#39;n&lt;&amp;-&#39; Close input file descriptor n.
# &#39;0&lt;&amp;-&#39;, &#39;&lt;&amp;-&#39;, Close stdin
$ echo 1234567890 &gt; File    # Write string to &quot;File&quot;.
$ exec 3&lt;&gt; File             # Open &quot;File&quot; and assign fd 3 to it.
$ read -n 4 &lt;&amp;3             # Read only 4 characters.
$ echo -n . &gt;&amp;3             # Write a decimal point there.
$ exec 3&gt;&amp;-                 # Close fd 3.
$ cat File                  # ==&gt; 1234.67890
#  Random access, by golly.
</code></pre>
<h3 id="shebang">Shebang</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/10376206/what-is-the-preferred-bash-shebang/10383546#10383546" class="uri">https://stackoverflow.com/questions/10376206/what-is-the-preferred-bash-shebang/10383546#10383546</a></li>
<li>Use <code>#!/usr/bin/env bash</code> for portability :: *Different <strong>nixes</strong> put <code>bash</code> in different places, and using <code>/usr/bin/env</code> is a workaround to run the <strong>first bash found on the PATH</strong>.</li>
</ul>
<h3 id="shell-parameter-expansion">Shell Parameter Expansion</h3>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/bashref.html#Shell-Parameter-Expansion" class="uri">https://www.gnu.org/software/bash/manual/bashref.html#Shell-Parameter-Expansion</a></li>
</ul>
<ol>
<li><p>unset and null testing expansions</p>
<ul>
<li><p><em>unset-null-examples.sh</em></p></li>
<li><code>${parameter:-word}</code> ::</li>
</ul>
<pre class="example"><code>if not parameter:
  word
else:
  parameter
</code></pre>
<dl>
<dt><code>${parameter:=word}</code></dt>
<dd>
</dd>
</dl>
<pre class="example"><code>if not parameter:
  parameter = word
  parameter
</code></pre>
<dl>
<dt><code>${parameter:?word}</code></dt>
<dd>
</dd>
</dl>
<pre class="example"><code>if not parameter:
  stderr.write(word)
  exit
else:
  parameter
</code></pre>
<dl>
<dt><code>${parameter:+word}</code></dt>
<dd>
</dd>
</dl>
<pre class="example"><code>if not parameter:
  parameter
else:
  word
</code></pre>
<dl>
<dt>non <code>:</code> versions (like <code>${parameter-word}</code>)</dt>
<dd><p>Tests only whether <code>parameter</code> is <code>unset</code>, but not <code>null</code></p>
</dd>
<dt><code>word</code></dt>
<dd><p>Can be a variable like <code>$(parameter:-$foo}</code></p>
</dd>
</dl>
<pre class="shell"><code>unset FOO
echo ${FOO-bar}   # bar
echo ${FOO?bar}   # (cause an error)
echo ${FOO+bar}   # (unset value of FOO)
echo ${FOO:-bar}  # bar
echo ${FOO:?bar}  # (cause an error)
echo ${FOO:+bar}  # (unset value of FOO)
unset FOO
echo ${FOO=bar}   # bar
echo ${FOO}       # bar
unset FOO
echo ${FOO:=bar}  # bar
echo ${FOO}       # bar


FOO=
echo ${FOO-bar}   # (null value of FOO)
echo ${FOO?bar}   # (null value of FOO)
echo ${FOO+bar}   # bar
echo ${FOO:-bar}  # bar
echo ${FOO:?bar}  # (cause an error)
echo ${FOO:+bar}  # (null value of FOO)
FOO=
echo ${FOO=bar}   # (null value of FOO)
echo ${FOO}       # (null value of FOO)
FOO=
echo ${FOO:=bar}  # bar
echo ${FOO}       # bar


FOO=foo
echo ${FOO-bar}   # foo
echo ${FOO?bar}   # foo
echo ${FOO+bar}   # bar
echo ${FOO:-bar}  # foo
echo ${FOO:?bar}  # foo
echo ${FOO:+bar}  # bar
FOO=foo
echo ${FOO=bar}   # foo
echo ${FOO}       # foo
FOO=foo
echo ${FOO:=bar}  # foo
echo ${FOO}       # foo
</code></pre></li>
<li><p>offset and length</p>
<pre class="shell"><code>${parameter:offset}        # parameter[offset:]
${parameter:offset:length} # parameter[offset:offset+length]
</code></pre>
<pre class="shell"><code># 1. A normal variable
$ string=01234567890abcdefgh
$ echo ${string:7}
7890abcdefgh
$ echo ${string:7:2}
78

# If length evaluates to a number less than zero,
# it is interpreted as an offset in characters from the end of the value of parameter
# rather than a number of characters
$ echo ${string:7:-2}
7890abcdef

# offset can be negative, but must be separated from the colon by at least one space
# to avoid being confused with the ‘:-’ expansion.
$ echo ${string: -7}
bcdefgh
$ echo ${string: -7:-2}
bcdef

# 2. Arguments
$ set -- 01234567890abcdefgh
$ echo ${1:7}
7890abcdefgh

# 3. Array
$ array[0]=01234567890abcdefgh
$ echo ${array[0]:7}
7890abcdefgh
</code></pre></li>
<li><p>begining and trailing match deletion (<code>#</code>, <code>%</code>)</p>
<ul>
<li>The <code>word</code> is expanded to produce a pattern just as in <a href="#filename-expansion">Filename Expansion</a></li>
</ul>
<pre class="shell"><code># If the pattern matches the **beginning** of the expanded value of parameter,
${parameter#word}  # the shortest matching pattern **deleted**
${parameter##word} # the longest matching pattern **deleted**

# If the pattern matches a **trailing portion** of the expanded value of parameter,
${parameter%word}  # the shortest matching pattern **deleted**
${parameter%%word} # the longest matching pattern **deleted**
</code></pre></li>
<li><p>replace</p>
<ul>
<li>The <code>pattern</code> is expanded to produce a pattern just as in <a href="#filename-expansion">Filename Expansion</a></li>
</ul>
<pre class="shell"><code>${parameter/pattern/string}  # the longest match of pattern against its value is replaced with string.
${parameter//pattern/string} # all matches of pattern are replaced with string.
${parameter/#pattern/string} # matches at the beginning of the expanded value of parameter.
${parameter/%pattern/string} # matches at the end of the expanded value of parameter.
${parameter/pattern/}        # deleted
${parameter/pattern}         # same as above
</code></pre>
<pre class="shell" data-outputs="yes"><code>export FOO=&#39;a.b.c.d&#39;
echo &quot;${FOO/[.]/-}&quot;
echo &quot;${FOO//[.]/-}&quot;
</code></pre>
<pre class="example"><code>| a-b.c.d |
| a-b-c-d |
</code></pre></li>
<li><p>Others</p>
<pre class="shell"><code># This expansion modifies the case of alphabetic characters in parameter.
${parameter^pattern}
${parameter^^pattern}
${parameter,pattern}
${parameter,,pattern}

# The expansion is either a transformation of the value of parameter or information about parameter itself, depending on the value of operator.
# Operators: Q, E, P, A, a
${parameter@operator}
</code></pre></li>
</ol>
<h1 id="topics">Topics</h1>
<h2 id="subtlety-of-following-symlinks">Subtlety of Following Symlinks</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/31114/find-usage-with-l" class="uri">https://unix.stackexchange.com/questions/31114/find-usage-with-l</a></li>
</ul>
<p>The general rule is,</p>
<dl>
<dt>if a command operates on links (i.e. directory entries, which are pointers to inodes)</dt>
<dd>The command treats symlinks as themselves rather than as the object the link points to.
</dd>
</dl>
<pre class="shell"><code>$ mkdir a
$ ln -s a aa
$ cp -R aa b  # -R, because followed &#39;aa&#39; is a directory
# ----------------------------------------------
a
aa -&gt; a
b -&gt; a
# ----------------------------------------------
# &#39;b&#39; is a copy of the symlink (&#39;aa&#39;), not the actual file (&#39;a&#39;)
</code></pre>
<dl>
<dt>Otherwise</dt>
<dd>The command operates on what the symlink points to.
</dd>
</dl>
<pre class="shell"><code>$ touch a
$ ln -s a aa
$ cp aa b
# ----------------------------------------------
a
aa -&gt; a
b
# ----------------------------------------------
# &#39;b&#39; is a copy of the actual file (&#39;a&#39;)
</code></pre>
<h2 id="usage-of-dash---in-place-of-a-filename-like-cat--">Usage of dash (-) in place of a filename, like 'cat -'</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/16357/usage-of-dash-in-place-of-a-filename" class="uri">https://unix.stackexchange.com/questions/16357/usage-of-dash-in-place-of-a-filename</a></li>
</ul>
<p>Using <code>-</code> as a filename to mean <code>stdin</code> / <code>stdout</code> is a convention that a lot of programs use. It is not a special property of the filename. If you want to use a file named as <code>-</code>, you should pass the argument like <code>./-</code>.</p>
<h1 id="how-to">How-to</h1>
<h2 id="change-hostname">Change hostname</h2>
<pre class="shell"><code>sudo sed -i &quot;s/^127.0.0.1 localhost.*\$/127.0.0.1 localhost ${NEW_NAME}/&quot; /etc/hosts
sudo bash -c &quot;echo ${NEW_NAME} &gt; /etc/hostname&quot;
sudo hostname &quot;${NEW_NAME}&quot;
</code></pre>
<h2 id="delete-all-broken-symbolic-links">Delete all broken symbolic links</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/22097130/delete-all-broken-symbolic-links-with-a-line" class="uri">https://stackoverflow.com/questions/22097130/delete-all-broken-symbolic-links-with-a-line</a></li>
</ul>
<pre class="shell"><code>find -L &quot;$HOME&quot; -maxdepth 1 -type l -exec rm {} +
#     │              │            │             └─ cause &#39;rm path1 path2&#39; not &#39;rm path1&#39; &#39;rm path2&#39;
#     │              │            + symbolic link
#     │              + descend at most n directory levels
#     │                in other words, just find in current directory
#     └─ follow symlinks, the link itself if the link target doens&#39;t exist
</code></pre>
<h2 id="delete-empty-directories-recursively">Delete empty directories recursively</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/46322/how-can-i-recursively-delete-empty-directories-in-my-home-directory" class="uri">https://unix.stackexchange.com/questions/46322/how-can-i-recursively-delete-empty-directories-in-my-home-directory</a></li>
</ul>
<pre class="shell"><code>find . -type d -empty -print
find . -type d -empty -delete
</code></pre>
<h2 id="empty-the-contents-of-a-file">Empty the contents of a file</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/88808/empty-the-contents-of-a-file" class="uri">https://unix.stackexchange.com/questions/88808/empty-the-contents-of-a-file</a></li>
</ul>
<pre class="shell"><code>&gt; filename                   # clever
cp /dev/null filename        # naive
cat /dev/null &gt; filename     # intuitive
dd if=/dev/null of=filename  # efficient
truncate filename --size 0   # explicit
</code></pre>
<h2 id="force-exit-code-0-in-spite-of-error">Force exit code 0 in spite of error</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/118217/chmod-silent-mode-how-force-exit-code-0-in-spite-of-error" class="uri">https://unix.stackexchange.com/questions/118217/chmod-silent-mode-how-force-exit-code-0-in-spite-of-error</a></li>
</ul>
<pre class="shell"><code>set -euo pipefail
&lt;command&gt; || true
echo &#39;Prints even if &lt;command&gt; fails&#39;
</code></pre>
<h2 id="get-the-source-directory">Get the source directory</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/59895/getting-the-source-directory-of-a-bash-script-from-within" class="uri">http://stackoverflow.com/questions/59895/getting-the-source-directory-of-a-bash-script-from-within</a></li>
<li><a href="https://stackoverflow.com/questions/35006457/choosing-between-0-and-bash-source" class="uri">https://stackoverflow.com/questions/35006457/choosing-between-0-and-bash-source</a></li>
</ul>
<pre class="shell"><code>DIR=&quot;$(cd &quot;$(dirname &quot;${BASH_SOURCE[0]}&quot;)&quot; &amp;&amp; pwd)&quot;
</code></pre>
<p><code>${BASH_SOURCE[0]}</code> can also be used when the script is sourced, where <code>$0</code> can't be used. Repalce <code>BASH_SOURCE</code> with <code>$0</code> for zsh, taking account of the <a href="http://stackoverflow.com/questions/35006457/choosing-between-0-and-bash-source">limitation</a>.</p>
<h2 id="glob-dotfiles">Glob dotfiles</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/20895502/bash-asterisk-omits-files-that-start-with" class="uri">http://stackoverflow.com/questions/20895502/bash-asterisk-omits-files-that-start-with</a></li>
<li><a href="http://unix.stackexchange.com/questions/89749/cp-hidden-files-with-glob-patterns" class="uri">http://unix.stackexchange.com/questions/89749/cp-hidden-files-with-glob-patterns</a></li>
</ul>
<p>You can't just match dotfiles(whose names start with <code>.</code>) with the wildcard(<code>*</code>). There are some workarounds:</p>
<pre class="shell"><code>for item in .* *; do echo &quot;$item&quot;; done  # simplest

# for bash (shopt is bash specific)
shopt -s dotglob  # set dotglob
echo *
shopt -u dotglob  # unset dotglob

# for zsh (glob qualifier, GLOB_DOTS)
$ cp foo/*(D) .
</code></pre>
<h2 id="pipe-stderr-and-not-stdout">Pipe stderr, and not stdout?</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/2342826/how-to-pipe-stderr-and-not-stdout" class="uri">https://stackoverflow.com/questions/2342826/how-to-pipe-stderr-and-not-stdout</a></li>
<li>Redirect <code>stderr</code> to <code>stdout</code></li>
<li>Redirect <code>stdout</code> to <code>/dev/null</code></li>
</ul>
<pre class="shell"><code>command 2&gt;&amp;1 &gt;/dev/null | grep &#39;something&#39;
</code></pre>
<h2 id="prevent-partially-downloaded-scripts-from-executing">Prevent partially downloaded scripts from executing</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line#everyday-use" class="uri">https://github.com/jlevy/the-art-of-command-line#everyday-use</a></li>
</ul>
<pre class="shell"><code>{
    # Your code here
}
</code></pre>
<h2 id="prompt-a-user-for-yesno">Prompt a user for yes/no</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/3231804/in-bash-how-to-add-are-you-sure-y-n-to-any-command-or-alias/3231821#3231821" class="uri">http://stackoverflow.com/questions/3231804/in-bash-how-to-add-are-you-sure-y-n-to-any-command-or-alias/3231821#3231821</a></li>
<li><a href="http://stackoverflow.com/questions/226703/how-do-i-prompt-for-yes-no-cancel-input-in-a-linux-shell-script" class="uri">http://stackoverflow.com/questions/226703/how-do-i-prompt-for-yes-no-cancel-input-in-a-linux-shell-script</a></li>
</ul>
<pre class="shell"><code>read -p &quot;Are you sure you want to continue? &lt;y/N&gt; &quot; prompt
if [[ &quot;$prompt&quot; =~ [yY](es)* ]]; then
fi
</code></pre>
<h2 id="run-python-simple-web-server-for-sharing-files">Run python simple web server for sharing files</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line#everyday-use" class="uri">https://github.com/jlevy/the-art-of-command-line#everyday-use</a></li>
</ul>
<pre class="shell"><code>python -m SimpleHTTPServer 7777
python3 -m http.server 7777
</code></pre>
<h2 id="temporarily-move-to-a-different-working-directory-via-subshell">Temporarily move to a different working directory via subshell</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line#everyday-use" class="uri">https://github.com/jlevy/the-art-of-command-line#everyday-use</a></li>
</ul>
<pre class="shell"><code># do something in current dir
(cd /some/other/dir &amp;&amp; other-command)
# continue in original dir
</code></pre>
<h2 id="test-whether-a-command-exists">Test whether a command exists</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script" class="uri">https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script</a></li>
</ul>
<pre class="shell"><code>$ command -v &#39;curl&#39;
/usr/bin/curl

$ command -v &#39;curl&#39; &gt;/dev/null 2&gt;&amp;1; echo &quot;$?&quot;
0

$ command -v &#39;carl&#39; &gt;/dev/null 2&gt;&amp;1; echo &quot;$?&quot;
1
</code></pre>
<h2 id="trim-a-variable">Trim a variable</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/369758/how-to-trim-whitespace-from-a-bash-variable" class="uri">https://stackoverflow.com/questions/369758/how-to-trim-whitespace-from-a-bash-variable</a></li>
<li>See also <a href="#shell-parameter-expansion">Shell Parameter Expansion</a></li>
</ul>
<pre class="shell"><code>trim() {
  local s=&quot;$1&quot;
  # Remove leading whitespace characters
  s=&quot;${s#&quot;${s%%[![:space:]]*}&quot;}&quot;
  # Remove trailing whitespace characters
  s=&quot;${s%&quot;${s##*[![:space:]]}&quot;}&quot;
  echo -n &quot;$s&quot;
  #     └─ do not print the trailing newline character
}
</code></pre>
<h2 id="use-command-output-as-a-file">Use command output as a file</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line#everyday-use" class="uri">https://github.com/jlevy/the-art-of-command-line#everyday-use</a></li>
</ul>
<pre class="shell"><code>diff /etc/hosts &lt;(ssh somehost cat /etc/hosts)
</code></pre>
<h2 id="useful-one-liners">Useful One-liners</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line#one-liners" class="uri">https://github.com/jlevy/the-art-of-command-line#one-liners</a></li>
</ul>
<pre class="shell"><code>cat a b | sort | uniq &gt; c        # c is a union b
cat a b | sort | uniq -d &gt; c     # c is a intersect b
cat a b b | sort | uniq -u &gt; c   # c is set difference a - b

grep . *     # overview for contents of current directory
head -100 *  # same as above, with only first 100 lines

# sum of all numbers in the third column
awk &#39;{ x += $3 } END { print x }&#39; myfile
</code></pre>
<h2 id="wait-until-a-port-available">Wait until a port available</h2>
<ul>
<li><a href="https://unix.stackexchange.com/questions/5277/how-do-i-tell-a-script-to-wait-for-a-process-to-start-accepting-requests-on-a-po" class="uri">https://unix.stackexchange.com/questions/5277/how-do-i-tell-a-script-to-wait-for-a-process-to-start-accepting-requests-on-a-po</a></li>
</ul>
<pre class="shell"><code># Wait until 3306 port available
while ! nc -z localhost 3306; do sleep 3; done
</code></pre>
<h2 id="kill-all-background-processes-when-the-shell-script-exits">Kill all background processes when the shell script exits</h2>
<pre class="shell"><code># signaling compatibility across shells
trap &quot;exit&quot; INT TERM ERR

# send TERM to the current process group when the shell script exits
trap &quot;kill 0&quot; EXIT

# jobs
./someProcessA &amp;
./someProcessB &amp;

# wait until jobs end
wait
</code></pre>
<ul>
<li>signals are propagated to subprocesses by default</li>
<li>However, shells like <code>bash</code> set the signal mask of <code>SIG_IGN</code> to <code>SIGINT</code> and <code>SIGQUIT</code></li>
<li>So, by using <code>trap</code>, send <code>TERM</code> to subprocess manually when the parent script exits</li>
<li>If the subprocess handles <code>SIGINT</code> manually, it would receive both signals of <code>SIGINT</code> and <code>SIGTERM</code></li>
</ul>
<hr />
<ul>
<li><a href="https://spin.atomicobject.com/2017/08/24/start-stop-bash-background-process/" class="uri">https://spin.atomicobject.com/2017/08/24/start-stop-bash-background-process/</a></li>
<li><a href="https://stackoverflow.com/questions/360201/how-do-i-kill-background-processes-jobs-when-my-shell-script-exits" class="uri">https://stackoverflow.com/questions/360201/how-do-i-kill-background-processes-jobs-when-my-shell-script-exits</a></li>
</ul>
<h1 id="links">Links</h1>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line" class="uri">https://github.com/jlevy/the-art-of-command-line</a></li>
<li><a href="https://google.github.io/styleguide/shell.xml" class="uri">https://google.github.io/styleguide/shell.xml</a></li>
<li><a href="https://github.com/progrium/bashstyle" class="uri">https://github.com/progrium/bashstyle</a></li>
<li><a href="https://github.com/bahamas10/bash-style-guide" class="uri">https://github.com/bahamas10/bash-style-guide</a></li>
<li><a href="https://github.com/alebcay/awesome-shell" class="uri">https://github.com/alebcay/awesome-shell</a></li>
<li><a href="http://www.commandlinefu.com/" class="uri">http://www.commandlinefu.com/</a></li>
<li><a href="https://github.com/alrra/dotfiles" class="uri">https://github.com/alrra/dotfiles</a></li>
</ul>
</body>
</html>
