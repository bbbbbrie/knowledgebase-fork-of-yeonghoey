#+TITLE: Amazon API Gateway

* Table of Contents :TOC_2_gh:
- [[#overview][Overview]]
- [[#topics][Topics]]
  - [[#deployments][Deployments]]
  - [[#lambda-proxy-integrations][Lambda Proxy Integrations]]

* Overview
[[file:_img/screenshot_2018-03-19_17-20-27.png]]

[[file:_img/screenshot_2016-12-22_21-19-33.png]]
* Topics
** Deployments
- https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-deploy-api.html
- Deployment :: assoicated with a stage
- Stage :: a snapshot of API
  - adjusting the default account-level
  - request throttling limits 
  - enabling API caching. 
  - Stages enable robust version control of your API
- [[https://docs.aws.amazon.com/apigateway/latest/developerguide/canary-release.html][Canary release]] :: updated version on the same stage

*** Throttling
- https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-request-throttling.html

*** Caching
- https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-caching.html

*** Logging
*** Variables
- https://docs.aws.amazon.com/apigateway/latest/developerguide/stage-variables.html
- Using stage variables you can configure an API deployment stage to interact with different backend endpoints.
- When you call your ~beta~ endpoint, API Gateway uses the stage variable for the ~beta~ stage, and calls a different web host (for example, ~beta.example.com~)

** Lambda Proxy Integrations
- https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html

#+BEGIN_QUOTE
With the Lambda proxy integration, when a client submits an API request,
API Gateway passes to the integrated Lambda function the raw request as-is.
This request data includes the request headers, query string parameters, URL path variables, payload, and API configuration data.
*The configuration data can include current deployment stage name, stage variables, user identity, or authorization context (if any)*
#+END_QUOTE

The request data format is:
#+BEGIN_SRC json
  {
      "resource": "Resource path",
      "path": "Path parameter",
      "httpMethod": "Incoming request's method name"
      "headers": {Incoming request headers}
      "queryStringParameters": {query string parameters }
      "pathParameters":  {path parameters}
      "stageVariables": {Applicable stage variables}
      "requestContext": {Request context, including authorizer-returned key-value pairs}
      "body": "A JSON string of the request payload."
      "isBase64Encoded": "A boolean flag to indicate if the applicable request payload is Base64-encode"
  }
#+END_SRC

The desired output format is:
#+BEGIN_SRC json
  {
      "isBase64Encoded": true|false,
      "statusCode": httpStatusCode,
      "headers": { "headerName": "headerValue", ... },
      "body": "..."
  }
#+END_SRC
