#+TITLE: Couchbase


* Table of Contents :TOC_2_gh:
- [[#how-to][How-to]]
- [[#topics][Topics]]
  - [[#document-expiration][Document Expiration]]
- [[#reference][Reference]]
  - [[#internalsettings][internalSettings]]
- [[#staging][Staging]]
  - [[#tunable-memory-and-ejection-policy][Tunable Memory and Ejection Policy]]

* How-to
* Topics
** Document Expiration
- https://developer.couchbase.com/documentation/server/3.x/developer/dev-guide-3.0/doc-expiration.html
- https://developer.couchbase.com/documentation/server/3.x/admin/CLI/CBepctl/cbepctl-diskcleanup.html


- ~TTL~ in *seconds* if it's *30 days or less*
- ~TTL~ in *Unix time* if it's *over 30 days*
- Couchbase runs a process named ~expiry pager~ periodically to clean up expired items
- ~Expire pager~ runs every ~60~ minutes by default(can be configured through ~[[https://developer.couchbase.com/documentation/server/3.x/admin/CLI/CBepctl/cbepctl-diskcleanup.html][exp_pager_stime]]~)

* Reference
** internalSettings
- https://developer.couchbase.com/documentation/server/current/rest-api/rest-get-internal-setting.html

#+BEGIN_SRC shell
  $ curl -u Administrator:password -v http://localhost:8091/internalSettings
  {
    "indexAwareRebalanceDisabled": false,
    "rebalanceIndexWaitingDisabled": false,
    "rebalanceIndexPausingDisabled": false,
    "rebalanceIgnoreViewCompactions": false,
    "rebalanceMovesPerNode": 1,
    "rebalanceMovesBeforeCompaction": 64,
    "maxParallelIndexers": 4,
    "maxParallelReplicaIndexers": 2,
    "maxBucketCount": 10,
    "gotraceback": "crash",
    "indexAutoFailoverDisabled": true,
    "certUseSha1": false
  }
#+END_SRC

* Staging
** Tunable Memory and Ejection Policy
- https://developer.couchbase.com/documentation/server/4.6/architecture/db-engine-architecture.html#concept_b5n_bwn_vs__full-ejection
