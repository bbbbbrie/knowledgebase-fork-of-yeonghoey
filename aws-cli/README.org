#+TITLE: AWS Command Line Interface

* Table of Contents :TOC_3_gh:
- [[#configure][configure]]
- [[#ec2][ec2]]
- [[#s3][s3]]
- [[#iam][iam]]

* configure
- http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html

#+BEGIN_SRC shell
  # when '--profile' omitted, considered it as 'default'
  $ aws configure --profile user2
  AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE
  AWS Secret Access Key [None]: je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
  Default region name [None]: us-east-1
  Default output format [None]: text
#+END_SRC

#+BEGIN_SRC shell
  # Specify options as arguments
  aws ec2 describe-instances --output table --region us-west-1
#+END_SRC

* ec2
:REFERENCES:
- http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html#cli-aws-ec2
- http://docs.aws.amazon.com/cli/latest/reference/ec2/modify-instance-attribute.html
- http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#using-regions-availability-zones-describe
- http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-images.html
:END:

#+BEGIN_SRC shell
  # Make the instance terminable (Disable Termination Protection)
  aws ec2 modify-instance-attribute --instance-id <value> --no-disable-api-termination

  # Retrieve availability zones
  aws ec2 describe-availability-zones --region eu-west-1

  aws ec2 describe-images | grep ubuntu
  aws ec2 describe-images --owners 099720109477 --filters 'Name=name,Values=*ubuntu-*-16.04*' --query 'Images[*].{NAME: Name, ID: ImageId}' --output text
#+END_SRC

* s3
:REFERENCES:
- https://cloudacademy.com/blog/aws-cli-10-useful-commands/
- http://docs.aws.amazon.com/cli/latest/reference/s3/index.html#available-commands
:END:

#+BEGIN_SRC shell
  aws s3 mv test.txt s3://mybucket/test2.txt
  aws s3 mv s3://mybucket/test.txt s3://mybucket/test2.txt
  aws s3 mv s3://mybucket/test.txt test2.txt
  aws s3 mv s3://mybucket . --recursive
  aws s3 mv myDir s3://mybucket/ --recursive --exclude "*.jpg"
  aws s3 mv s3://mybucket/ s3://mybucket2/ --recursive --exclude "mybucket/another/*"

  # delete a bucket and all its contents
  aws s3 rb s3://bucket-name --force

  aws s3 cp MyFolder s3://bucket-name --recursive

  # upload a stream from stdin to s3
  aws s3 cp - s3://my-bucket/stream

  # download an s3 object as a stdout stream
  aws s3 cp s3://my-bucket/stream

  # list the sizes of an S3 bucket and its contents
  aws s3api list-objects --bucket BUCKETNAME --output json --query "[sum(Contents[].Size), length(Contents[])]"

  # inter-region sync
  aws s3 sync s3://oldbucket s3://newbucket --source-region us-west-1 --region us-west-2
#+END_SRC

* iam
:REFERENCES:
- https://cloudacademy.com/blog/aws-cli-10-useful-commands/
:END:

#+BEGIN_SRC shell
  aws iam list-users --output table
  aws iam list-users --output json | jq -r .Users[].Arn
#+END_SRC
