#+TITLE: Vue.js

* Table of Contents :TOC_3_gh:
- [[#overview][Overview]]
  - [[#getting-started][Getting Started]]
  - [[#data-and-methods][Data and Methods]]
  - [[#lifecycle][Lifecycle]]
    - [[#mounted][mounted]]
  - [[#computed-and-watch][computed and watch]]
- [[#template-syntax][Template Syntax]]
- [[#api][API]]
  - [[#vueoptions][Vue(options)]]
  - [[#v-bind][v-bind]]
- [[#components][Components]]
  - [[#global-components][Global Components]]
  - [[#local-components][Local Components]]
  - [[#composing-components][Composing Components]]
  - [[#props][props]]
- [[#single-file-components-vue][Single File Components (.vue)]]
- [[#router][Router]]
  - [[#router-link][<router-link>]]
  - [[#router-view][<router-view>]]
  - [[#history-mode][history mode]]
  - [[#matching][Matching]]
  - [[#the-route-object][The Route object]]
  - [[#route-meta-fields][Route Meta Fields]]
  - [[#navigation-guards][Navigation Guards]]
  - [[#passing-props][Passing Props]]
  - [[#programmatic-navigation][Programmatic Navigation]]
- [[#how-to][How-to]]
  - [[#configure-different-environment-variables-by-stage][Configure different environment variables by stage]]
  - [[#use-axios-with-vuejs][Use axios with Vue.js]]
- [[#links][Links]]

* Overview
:REFERENCES:
- https://vuejs.org/v2/guide/installation.html#CLI
:END:

** Getting Started
#+BEGIN_SRC shell
  # install vue-cli
  $ npm install --global vue-cli
  # create a new project using the "webpack" template
  $ vue init webpack my-project
  # install dependencies and go!
  $ cd my-project
  $ npm run dev
#+END_SRC

** Data and Methods
#+BEGIN_QUOTE
*When a Vue instance is created*, it adds all the properties found in its ~data~ object to Vue’s reactivity system.
#+END_QUOTE

#+BEGIN_QUOTE
Vue instances expose a number of useful instance properties and methods.
These properties and methods are prefixed with ~$~ to differentiate from proxied data properties. For example:
#+END_QUOTE

#+BEGIN_SRC javascript
  var data = { a: 1 }
  var vm = new Vue({
    el: '#example',
    data: data
  })
  vm.$data === data // -> true
  vm.$el === document.getElementById('example') // -> true
  // $watch is an instance method
  vm.$watch('a', function (newVal, oldVal) {
    // this callback will be called when `vm.a` changes
  })
#+END_SRC

** Lifecycle
- https://vuejs.org/v2/guide/instance.html#Lifecycle-Diagram

#+BEGIN_QUOTE
Don’t use arrow functions on an options property or callback, such as ~created: () => console.log(this.a)~ or ~vm.$watch('a', newValue => this.myMethod())~. Since arrow functions are bound to the parent context, this will not be the Vue instance as you’d expect, often resulting in errors
#+END_QUOTE

[[file:_img/screenshot_2018-03-07_11-48-43.png]]
[[file:_img/screenshot_2018-03-07_11-04-42.png]]

*** mounted
- https://vuejs.org/v2/api/#mounted

** computed and watch
:REFERENCES:
- https://vuejs.org/v2/guide/computed.html
:END:

- computed ::
  - caches the value when first calculated
  - updates automatically when its dependent variables changed

  #+BEGIN_SRC js
    var vm = new Vue({
      el: '#example',
      data: {
        message: 'Hello'
      },
      computed: {
        // a computed getter
        reversedMessage: function () {
          // `this` points to the vm instance
          return this.message.split('').reverse().join('')
        }
      }
    })
  #+END_SRC

- watch ::
  - call back of data field's change event
  #+BEGIN_SRC js
    var vm = new Vue({
      el: '#demo',
      data: {
        firstName: 'Foo',
        lastName: 'Bar',
        fullName: 'Foo Bar'
      },
      watch: {
        firstName: function (val) {
          this.fullName = val + ' ' + this.lastName
        },
        lastName: function (val) {
          this.fullName = this.firstName + ' ' + val
        }
      }
    })
  #+END_SRC
* Template Syntax
:REFERENCES:
- https://vuejs.org/v2/guide/syntax.html
:END:

- The ~v-~ prefix serves as a visual cue for identifying Vue-specific attributes in your templates. 

- In templates, the context of ~this~, which is the corresponding ~Vue~ object can be referred without ~this~.
#+BEGIN_SRC html
  <!-- msg is data property of the Vue object-->
  <span>Message: {{ msg }}</span>
  <span v-once>This will never change: {{ msg }}</span>
#+END_SRC

#+BEGIN_SRC html
  <p>Using mustaches: {{ rawHtml }}</p>
  <p>Using v-html directive: <span v-html="rawHtml"></span></p>
#+END_SRC

[[file:_img/screenshot_2018-03-29_12-46-08.png]]

#+BEGIN_SRC html
  <!-- remove/insert the <p> element based on whether or not 'seen' is true. -->
  <p v-if="seen">Now you see me</p>
#+END_SRC

#+BEGIN_SRC html
  <!-- .prevent modifier tells the v-on directive to call event.preventDefault() on the triggered event: -->
  <form v-on:submit.prevent="onSubmit"> ... </form>
#+END_SRC

#+BEGIN_SRC html
  <!-- full syntax -->
  <a v-bind:href="url"> ... </a>
  <!-- shorthand -->
  <a :href="url"> ... </a>

  <!-- full syntax -->
  <a v-on:click="doSomething"> ... </a>
  <!-- shorthand -->
  <a @click="doSomething"> ... </a>
#+END_SRC

* API
** Vue(options)
- [[https://vuejs.org/v2/api/#data][data]] ::
  - Only accepts ~Function~ when used in a component definition.
  - The object must be plain
- [[https://vuejs.org/v2/api/#el][el]] ::
  - only respected in instance creation via new.
  - provide the Vue instance an existing DOM element to mount on. It can be a CSS selector string or an actual HTMLElement.
  - seems that it doesn't need to specify when using ~.vue~ files. 
  
** v-bind
:REFERENCES:
- https://vuejs.org/v2/api/#v-bind
- https://vuejs.org/v2/guide/class-and-style.html
:END:

Dynamically bind one or more attributes, or a component prop to an expression.

#+BEGIN_SRC html
  <!-- bind an attribute -->
  <img v-bind:src="imageSrc">

  <!-- shorthand -->
  <img :src="imageSrc">

  <!-- with inline string concatenation -->
  <img :src="'/path/to/images/' + fileName">

  <!-- class binding -->
  <div :class="{ red: isRed }"></div>
  <div :class="[classA, classB]"></div>

  <!-- class binding ('key' is included if 'value' is true -->
  <div :class="[classA, { classB: isB, classC: isC }]">
#+END_SRC

* Components
- https://vuejs.org/v2/guide/components.html

** Global Components
#+BEGIN_SRC html
  <div id="example">
    <my-component></my-component>
  </div>
#+END_SRC

#+BEGIN_SRC javascript
  // register
  Vue.component('my-component', {
    template: '<div>A custom component!</div>'
  })

  // create a root instance
  new Vue({
    el: '#example'
  })
#+END_SRC

** Local Components
:REFERENCES:
- https://v1.vuejs.org/guide/components.html#Component-Option-Caveats
:END:

- ~data~ and ~el~ should be functions, otherwise the state of components is all shared.

#+BEGIN_SRC javascript
  var Child = {
    template: '<div>A custom component!</div>'
  }

  new Vue({
    // ...
    components: {
      // <my-component> will only be available in parent's template
      'my-component': Child
    }
  })
#+END_SRC

** Composing Components
[[file:_img/screenshot_2018-03-07_14-04-10.png]]

The API for a Vue component comes in three parts - ~props~, ~events~, and ~slots~:
- Props allow the external environment to pass data into the component
- Events allow the component to trigger side effects in the external environment
- Slots allow the external environment to compose the component with extra content.

#+BEGIN_SRC html
  <my-component
    :foo="baz"
    :bar="qux"
    @event-a="doThis"
    @event-b="doThat"
  >
    <img slot="icon" src="...">
    <p slot="main-text">Hello!</p>
  </my-component>
#+END_SRC

** props
- https://vuejs.org/v2/guide/components.html#Props
- A ~prop~ is a field on a component’s ~data~ that is expected to be passed down from its parent component.
- So, a ~prop~ can be referenced as ~this.<prop>~ or ~{{ <prop> }}~

* Single File Components (.vue)
- https://vuejs.org/v2/guide/single-file-components.html

#+BEGIN_QUOTE
In many Vue projects, global components will be defined using ~Vue.component~, followed by ~new Vue({ el: '#container' })~ to target a container element in the body of every page.
#+END_QUOTE
* Router
- https://router.vuejs.org/en/

** <router-link>
- https://router.vuejs.org/en/api/router-link.html

Is preferred over ~<a href="...">~

#+BEGIN_SRC html
    <!-- literal string -->
    <router-link to="home">Home</router-link>
    <!-- renders to -->
    <a href="home">Home</a>

    <!-- javascript expression using `v-bind` -->
    <router-link v-bind:to="'home'">Home</router-link>

    <!-- Omitting `v-bind` is fine, just as binding any other prop -->
    <router-link :to="'home'">Home</router-link>

    <!-- same as above -->
    <router-link :to="{ path: 'home' }">Home</router-link>

    <!-- named route -->
    <router-link :to="{ name: 'user', params: { userId: 123 }}">User</router-link>

    <!-- with query, resulting in `/register?plan=private` -->
    <router-link :to="{ path: 'register', query: { plan: 'private' }}">Register</router-link>
#+END_SRC

** <router-view>
- https://router.vuejs.org/en/api/router-view.html
- A functional component that renders the matched component for the given path.
- Can use mutliple routes by [[https://router.vuejs.org/en/essentials/named-views.html][named-views]]

** history mode
- https://router.vuejs.org/en/essentials/history-mode.html

#+BEGIN_SRC javascript
  const router = new VueRouter({
    mode: 'history',
    routes: [...]
  })
#+END_SRC

#+BEGIN_QUOTE
Since our app is a single page client side app, without a proper server configuration,
the users will get a 404 error if they access http://oursite.com/user/id directly in their browser.
#+END_QUOTE

** Matching
:REFERENCES:
- https://github.com/pillarjs/path-to-regexp#parameters
- https://router.vuejs.org/en/essentials/dynamic-matching.html
- https://router.vuejs.org/en/essentials/dynamic-matching.html#matching-priority
:END:

#+BEGIN_SRC js
  pathToRegexp('/:foo/:bar?')
  pathToRegexp('/:foo*')
  pathToRegexp('/:foo+')
#+END_SRC

#+BEGIN_QUOTE
Sometimes the same URL may be matched by multiple routes.
In such a case the matching priority is determined by the order of route definition:
*the earlier a route is defined, the higher priority it gets.*
#+END_QUOTE

** The Route object
- https://router.vuejs.org/en/api/route-object.html

#+BEGIN_SRC javascript

  // For pattern '/:user', '/yeonghoey?test=no"
  $route.params.user === 'yeonghoey';
  $route.query.test === 'no';
#+END_SRC

** Route Meta Fields
- https://router.vuejs.org/en/advanced/meta.html

** Navigation Guards
- https://router.vuejs.org/en/advanced/navigation-guards.html

** Passing Props
:REFERENCES:
- https://router.vuejs.org/en/essentials/passing-props.html
:END:

#+BEGIN_QUOTE
When ~props~ is set to ~true~, the ~route.params~ will be set as the component props.
#+END_QUOTE

** Programmatic Navigation
- https://router.vuejs.org/en/essentials/navigation.html

* How-to
** Configure different environment variables by stage
:REFERENCES:
- https://vuejs.org/v2/guide/deployment.html
- https://vuejs-templates.github.io/webpack/env.html
:END:

- Use ~webpack.DefinePlugin~ to configure ~process.env~

If you use vue template is easier to configure:
#+BEGIN_SRC js
  // config/prod.env.js
  module.exports = {
    NODE_ENV: '"production"',
    DEBUG_MODE: false,
    API_KEY: '"..."' // this is shared between all environments
  }

  // config/dev.env.js
  module.exports = merge(prodEnv, {
    NODE_ENV: '"development"',
    DEBUG_MODE: true // this overrides the DEBUG_MODE value of prod.env
  })

  // config/test.env.js
  module.exports = merge(devEnv, {
    NODE_ENV: '"testing"'
  })
#+END_SRC

#+BEGIN_SRC js
  Vue.config.productionTip = process.env.NODE_ENV === 'production'
#+END_SRC

** Use axios with Vue.js
- http://vuejs.kr/update/2017/01/04/http-request-with-axios/

#+BEGIN_SRC javascript
  import Vue from 'vue'
  import App from './App'
  import axios from 'axios'

  // Use axios globally
  Vue.prototype.$http = axios

  // Or, just import axios in each component
#+END_SRC

* Links
- [[https://codesandbox.io/s/o29j95wx9][Simple Todo App]]
