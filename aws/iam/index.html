<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120656861-1"></script>
  <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'UA-120656861-1');
  </script>

  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />


  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="theme-color" content="#ffffff">

  <title>AWS IAM</title>

  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>

  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <link rel="stylesheet" href="/_css/content.css" />


  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->

  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono" rel="stylesheet">
</head>
<body>
<nav class="menu">
  <ol class="breadcrumb">
    <li><a href="/" >Home</a></li>
    <li><a href="/aws/" >aws</a></li>
    <li>iam</li>
  </ol>
</nav>

<article>
<header>
<h1 class="title">AWS IAM</h1>
</header>

<nav class="toc">
<h2>Table of Contents</h2>
<ul>
<li><a href="#reference">Reference</a><ul>
<li><a href="#assume-role-policy">assume-role-policy</a></li>
<li><a href="#kinesis">kinesis</a></li>
<li><a href="#s3">s3</a></li>
</ul></li>
<li><a href="#topics">Topics</a><ul>
<li><a href="#iam-role">IAM Role</a><ul>
<li><a href="#assume-role-policy-1">Assume Role Policy</a></li>
</ul></li>
<li><a href="#instance-profiles">Instance Profiles</a></li>
<li><a href="#policy-elements">Policy Elements</a><ul>
<li><a href="#id">Id</a></li>
<li><a href="#statement">Statement</a></li>
<li><a href="#effect">Effect</a></li>
<li><a href="#sid">Sid</a></li>
<li><a href="#principal">Principal</a></li>
<li><a href="#action">Action</a></li>
<li><a href="#resource">Resource</a></li>
<li><a href="#not-">Not-</a></li>
<li><a href="#condition">Condition</a></li>
</ul></li>
<li><a href="#policies-evaluation-logic">Policies Evaluation Logic</a></li>
</ul></li>
<li><a href="#how-to">How-to</a><ul>
<li><a href="#share-resources-with-an-external-aws-account-via-iam-role">Share resources with an external AWS account via IAM Role</a></li>
</ul></li>
<li><a href="#links">Links</a></li>
</ul>
</nav>

<h1 id="reference">Reference</h1>
<h2 id="assume-role-policy">assume-role-policy</h2>
<dl>
<dt>User (Replace <code>root</code> with an user name if restrict the role for a specific user)</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="dt">&quot;Principal&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;AWS&quot;</span><span class="fu">:</span> <span class="st">&quot;arn:aws:iam::123456789012:root&quot;</span><span class="fu">},</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="fu">}</span></a></code></pre></div>
<dl>
<dt>EC2</dt>
<dd>
</dd>
</dl>
<p>To attach the role to EC2 instances, an <strong>instance profile</strong> must be created.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">      <span class="dt">&quot;Principal&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;Service&quot;</span><span class="fu">:</span> <span class="st">&quot;ec2.amazonaws.com&quot;</span><span class="fu">},</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="fu">}</span></a></code></pre></div>
<dl>
<dt>Lambda</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">      <span class="dt">&quot;Sid&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">      <span class="dt">&quot;Principal&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;Service&quot;</span><span class="fu">:</span> <span class="st">&quot;lambda.amazonaws.com&quot;</span><span class="fu">},</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="fu">}</span></a></code></pre></div>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html</a></li>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html</a></li>
<li><a href="http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html" class="uri">http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html</a></li>
</ul>
</div>
<h2 id="kinesis">kinesis</h2>
<dl>
<dt>Readonly</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">        <span class="st">&quot;kinesis:Get*&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">        <span class="st">&quot;kinesis:DescribeStream&quot;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">        <span class="st">&quot;arn:aws:kinesis:us-east-1:111122223333:stream/stream1&quot;</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">        <span class="st">&quot;kinesis:ListStreams&quot;</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">        <span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="fu">}</span></a></code></pre></div>
<dl>
<dt>Writeonly</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">        <span class="st">&quot;kinesis:PutRecord&quot;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">        <span class="st">&quot;arn:aws:kinesis:us-east-1:111122223333:stream/*&quot;</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="fu">}</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"></a></code></pre></div>
<dl>
<dt>Fullaccess</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;kinesis:*&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">        <span class="st">&quot;arn:aws:kinesis:us-east-1:111122223333:stream/stream1&quot;</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="fu">}</span></a></code></pre></div>
<dl>
<dt>Fullaccess on all streams</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;kinesis:*&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">        <span class="st">&quot;arn:aws:kinesis:*:111122223333:stream/*&quot;</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="fu">}</span></a></code></pre></div>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/streams/latest/dev/controlling-access.html" class="uri">http://docs.aws.amazon.com/streams/latest/dev/controlling-access.html</a></li>
</ul>
</div>
<h2 id="s3">s3</h2>
<dl>
<dt>Programmatic Access</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;s3:ListBucket&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;arn:aws:s3:::test&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">        <span class="st">&quot;s3:PutObject&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">        <span class="st">&quot;s3:GetObject&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">        <span class="st">&quot;s3:DeleteObject&quot;</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;arn:aws:s3:::test/*&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="fu">}</span></a></code></pre></div>
<dl>
<dt>AWS Console Access</dt>
<dd>
</dd>
</dl>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">        <span class="st">&quot;s3:GetBucketLocation&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">        <span class="st">&quot;s3:ListAllMyBuckets&quot;</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="st">&quot;arn:aws:s3:::*&quot;</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;s3:ListBucket&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;arn:aws:s3:::test&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18">      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19">      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20">        <span class="st">&quot;s3:PutObject&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21">        <span class="st">&quot;s3:GetObject&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">        <span class="st">&quot;s3:DeleteObject&quot;</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">      <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;arn:aws:s3:::test/*&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="fu">}</span></a></code></pre></div>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html" class="uri">http://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html</a></li>
<li><a href="https://aws.amazon.com/ko/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/" class="uri">https://aws.amazon.com/ko/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/</a></li>
</ul>
</div>
<h1 id="topics">Topics</h1>
<h2 id="iam-role">IAM Role</h2>
<ul>
<li>With some AWS SDKs, can use temporary credentials transparently.</li>
<li>Alternatively, can get the temporary credentials directly from the EC2 instance metadata</li>
</ul>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-04-22_22-38-40.png" /></p>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html</a></li>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html</a></li>
</ul>
</div>
<h3 id="assume-role-policy-1">Assume Role Policy</h3>
<p><code>Assume Role Policy</code> describes how the role is used for. This is related to AWS STS(Security Token Service); Following is an example on a role for <strong>EC2</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="dt">&quot;Principal&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;Service&quot;</span><span class="fu">:</span> <span class="st">&quot;ec2.amazonaws.com&quot;</span><span class="fu">},</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="fu">}</span></a></code></pre></div>
<p>And it also requires its actual permissions:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;s3:ListBucket&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="st">&quot;arn:aws:s3:::example_bucket&quot;</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="fu">}</span></a></code></pre></div>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html" class="uri">http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html</a></li>
</ul>
</div>
<h2 id="instance-profiles">Instance Profiles</h2>
<p>The instance profile contains the role and can provide the role's credentials to an application that runs on the instance. If you use the IAM console, the instance profile is managed for you and is mostly transparent to you. if you use the AWS CLI or API to create and manage the role and EC2 instance, then <strong>you must create the instance profile and assign the role to it as separate steps.</strong> Then, when you launch the instance, <strong>you must specify the instance profile name</strong> instead of the role name.</p>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-08-17_19-33-27.png" /></p>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html</a></li>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html</a></li>
</ul>
</div>
<h2 id="policy-elements">Policy Elements</h2>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements.html</a></li>
</ul>
</div>
<h3 id="id">Id</h3>
<ul>
<li>An optional identifier</li>
<li>Using a UUID for the value is recommended</li>
<li>Services like SQS or SNS might require this</li>
</ul>
<pre class="example"><code>&quot;Id&quot;: &quot;cd3ad3d9-2776-4ef1-a904-4c229d1642ee&quot;
</code></pre>
<h3 id="statement">Statement</h3>
<ul>
<li>Required</li>
<li>Contains an array of individual statements</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="er">&quot;Statement&quot;:</span> <span class="ot">[</span><span class="fu">{</span><span class="er">...</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="er">...</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="er">...</span><span class="fu">}</span><span class="ot">]</span></a></code></pre></div>
<h3 id="effect">Effect</h3>
<ul>
<li>Either <code>Allow</code> or <code>Deny</code></li>
</ul>
<h3 id="sid">Sid</h3>
<ul>
<li>An optional identifier</li>
<li>The <code>Sid</code> value must be unique within a policy</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="er">&quot;Sid&quot;:</span> <span class="er">&quot;1&quot;</span></a></code></pre></div>
<h3 id="principal">Principal</h3>
<div class="REFERENCES drawer">
<ul>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html#Principal_specifying" class="uri">https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html#Principal_specifying</a></li>
</ul>
</div>
<p>To specify the user (IAM user, federated user, or assumed-role user), AWS account, AWS service, or other principal entity that is allowed or denied access to a resource.</p>
<h3 id="action">Action</h3>
<h3 id="resource">Resource</h3>
<h3 id="not-">Not-</h3>
<p><strong>NotPrincipal</strong>, <strong>NotAction</strong>, <strong>NotResource</strong> are dvanced policy elements that explicitly matches everything except the specified list of the elements.</p>
<h3 id="condition">Condition</h3>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-04-22_23-50-50.png" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="er">&quot;Condition&quot;</span> <span class="er">:</span>  <span class="fu">{</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">      <span class="dt">&quot;DateGreaterThan&quot;</span> <span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">         <span class="dt">&quot;aws:CurrentTime&quot;</span> <span class="fu">:</span> <span class="st">&quot;2013-08-16T12:00:00Z&quot;</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">       <span class="fu">},</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">      <span class="dt">&quot;DateLessThan&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">         <span class="dt">&quot;aws:CurrentTime&quot;</span> <span class="fu">:</span> <span class="st">&quot;2013-08-16T15:00:00Z&quot;</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">       <span class="fu">},</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">       <span class="dt">&quot;IpAddress&quot;</span> <span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">          <span class="dt">&quot;aws:SourceIp&quot;</span> <span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;192.0.2.0/24&quot;</span><span class="ot">,</span> <span class="st">&quot;203.0.113.0/24&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">      <span class="fu">}</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="fu">}</span></a></code></pre></div>
<p>The two values for <code>aws:SourceIp</code> are evaluated using <strong>OR</strong>. The three separate condition operators are evaluated using <strong>AND</strong>.</p>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#AvailableKeys" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#AvailableKeys</a></li>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_actionsconditions.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_actionsconditions.html</a></li>
</ul>
</div>
<h2 id="policies-evaluation-logic">Policies Evaluation Logic</h2>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-02-19_14-05-01.png" /></p>
<p>The enforcement code evaluates all user-based and resource-based policies that are applicable to the request(based on the resource, principal, action, and conditions). <strong>The order in which the enforcement code evaluates the policies is not important</strong>.</p>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-02-19_14-06-20.png" /></p>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html</a></li>
</ul>
</div>
<h1 id="how-to">How-to</h1>
<h2 id="share-resources-with-an-external-aws-account-via-iam-role">Share resources with an external AWS account via IAM Role</h2>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-05-29_18-30-17.png" /></p>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-05-29_18-30-28.png" /></p>
<p>This creates an assume role policy like this:</p>
<p><img src="https://media.yeonghoey.com/aws/iam/_img/screenshot_2017-05-29_18-32-21.png" /></p>
<p><code>Principal</code> is 3rd party's AWS account id. For example:</p>
<pre class="example"><code>&quot;AWS&quot;: &quot;arn:aws:iam::123456789012:root&quot;
</code></pre>
<p>But ironically, it's unable to specify an <code>ExternalID</code> when switching roles on AWS Console. They only can be specified through awscli or other programatic accesses.</p>
<p>An easy way to work around this is just delete that yellow line. This allows all users belong to target AWS Account to switch to the role.</p>
<div class="REFERENCES drawer">
<ul>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html</a></li>
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html" class="uri">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html</a></li>
</ul>
</div>
<h1 id="links">Links</h1>
</article>

</body>
</html>
