#+TITLE: AWS Command Line Interface

* Table of Contents :TOC_3_gh:
- [[#reference][Reference]]
  - [[#configure][configure]]
  - [[#ec2][ec2]]
    - [[#modify-instance-attribute][modify-instance-attribute]]
  - [[#s3][s3]]
- [[#how-to][How-to]]
  - [[#list-amis][List AMIs]]
  - [[#retrieve-availability-zones][Retrieve availability zones]]
- [[#staging][Staging]]
  - [[#2017-07-12-wed-aws-s3-wildcard][<2017-07-12 Wed> aws s3 wildcard]]

* Reference
** configure
- http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html

#+BEGIN_SRC shell
  # when '--profile' omitted, considered it as 'default'
  $ aws configure --profile user2
  AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE
  AWS Secret Access Key [None]: je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
  Default region name [None]: us-east-1
  Default output format [None]: text
#+END_SRC

#+BEGIN_SRC shell
  # Specify options as arguments
  aws ec2 describe-instances --output table --region us-west-1
#+END_SRC

** ec2
- http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html#cli-aws-ec2

*** modify-instance-attribute
#+BEGIN_SRC shell
  # Make the instance terminable (Disable Termination Protection)
  aws ec2 modify-instance-attribute --instance-id <value> --no-disable-api-termination
#+END_SRC

** s3
- http://docs.aws.amazon.com/cli/latest/reference/s3/index.html#available-commands

#+BEGIN_SRC shell
  aws s3 mv test.txt s3://mybucket/test2.txt
  aws s3 mv s3://mybucket/test.txt s3://mybucket/test2.txt
  aws s3 mv s3://mybucket/test.txt test2.txt
  aws s3 mv s3://mybucket . --recursive
  aws s3 mv myDir s3://mybucket/ --recursive --exclude "*.jpg"
  aws s3 mv s3://mybucket/ s3://mybucket2/ --recursive --exclude "mybucket/another/*"

#+END_SRC
* How-to
** List AMIs
- http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-images.html

#+BEGIN_SRC shell
  aws ec2 describe-images --owners 099720109477 --filters 'Name=name,Values=*ubuntu-*-16.04*' --query 'Images[*].{NAME: Name, ID: ImageId}' --output text
#+END_SRC

** Retrieve availability zones
- http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#using-regions-availability-zones-describe

#+BEGIN_SRC shell
$ aws ec2 describe-availability-zones --region eu-west-1
{
    "AvailabilityZones": [
        {
            "State": "available",
            "RegionName": "eu-west-1",
            "Messages": [],
            "ZoneName": "eu-west-1a"
        },
        {
            "State": "available",
            "RegionName": "eu-west-1",
            "Messages": [],
            "ZoneName": "eu-west-1b"
        },
        {
            "State": "available",
            "RegionName": "eu-west-1",
            "Messages": [],
            "ZoneName": "eu-west-1c"
        }
    ]
}
#+END_SRC

* Staging
** TODO <2017-07-12 Wed> aws s3 wildcard
http://docs.aws.amazon.com/cli/latest/reference/s3/index.html#use-of-exclude-and-include-filters
aws s3 sync s3://examplebucket/ . --exclude "*" --include "*/latest.json"
