<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Neo4j</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Neo4j</h1>
</header>
<h1 id="table-of-contents">Table of Contents <span class="tag" data-tag-name="TOC_2_gh"><span class="smallcaps">TOC_2_gh</span></span></h1>
<ul>
<li><a href="#firing-up">Firing Up</a></li>
<li><a href="#nodes">Nodes</a></li>
<li><a href="#relationships">Relationships</a></li>
<li><a href="#properties">Properties</a></li>
<li><a href="#uniqueness">Uniqueness</a></li>
<li><a href="#ordering-null">Ordering NULL</a></li>
<li><a href="#merge-vs-create-unique">MERGE vs CREATE UNIQUE</a></li>
<li><a href="#cycli">cycli</a></li>
<li><a href="#cheat-sheet">Cheat sheet</a>
<ul>
<li><a href="#basics">Basics</a></li>
<li><a href="#create-merge-delete">CREATE, MERGE, DELETE</a></li>
<li><a href="#set-remove-foreach">SET, REMOVE, FOREACH</a></li>
<li><a href="#indexes-and-constraints">Indexes and constraints</a></li>
<li><a href="#where">WHERE</a></li>
<li><a href="#skip-limit">SKIP, LIMIT</a></li>
<li><a href="#others">Others</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
<h1 id="firing-up">Firing Up</h1>
<p>Fire up quickly with <a href="https://hub.docker.com/r/library/neo4j/" class="uri">https://hub.docker.com/r/library/neo4j/</a></p>
<pre class="shell"><code>$ docker run --rm -it -p 7474:7474 --env=NEO4J_AUTH=none neo4j
</code></pre>
<h1 id="nodes">Nodes</h1>
<p>Nodes can have <strong>one or more</strong> labels.</p>
<h1 id="relationships">Relationships</h1>
<ul>
<li>Unlike labels, relationships <strong>can only have one type</strong>.</li>
<li>Every relationship has <strong>a direction</strong>.</li>
<li>There are <strong>no performance differences</strong> related to directions.</li>
<li>You can simply ignore them if you don't need them.</li>
</ul>
<h1 id="properties">Properties</h1>
<ul>
<li>Both nodes and relationships can have properties.</li>
<li><code>NULL</code> is not a valid property value.</li>
<li><code>NULL</code> can be modeled by the absence of a key.</li>
</ul>
<h1 id="uniqueness">Uniqueness</h1>
<pre class="cypher"><code>CREATE ({name: &quot;Finn&quot;}) -[:FRIEND]-&gt; ({name: &quot;Jake&quot;}) -[:FRIEND]-&gt; ({name: &quot;Rainicorn&quot;})
</code></pre>
<p>Let's find out friends of friends of <em>Finn</em>:</p>
<pre class="cypher"><code>MATCH (a) -[:FRIEND]- (b) -[:FRIEND]- (c)
WHERE a.name = &quot;Finn&quot;
RETURN c
</code></pre>
<p>(<em>Angle brackets of relationships are intentionally omitted for ignoring directions</em>)</p>
<p>It returns only <em>Rainicorn</em> as expected.</p>
<p>But from the theoretical perspective, <em>Finn</em> himself is valid for variable <code>c</code>. But it's suppressed.</p>
<p>This is because Neo4j <strong>doesn't use the same relationship multiple times within a single pattern</strong>. You need to divide up MATCH clause to have <em>Finn</em> included:</p>
<pre class="cypher"><code>MATCH (a) -[:FRIEND]- (b)
MATCH (b) -[:FRIEND]- (c)
WHERE a.name = &quot;Finn&quot;
RETURN c
</code></pre>
<h1 id="ordering-null">Ordering NULL</h1>
<ul>
<li><code>NULL</code> will always come at the end of the result set for ascending sorting.</li>
</ul>
<h1 id="merge-vs-create-unique">MERGE vs CREATE UNIQUE</h1>
<ul>
<li><code>CREATE UNIQUE</code> has slightly more obscure semantics than <code>MERGE</code>.</li>
<li><code>CREATE UNIQUE</code> is <a href="http://stackoverflow.com/questions/22773562/difference-between-merge-and-create-unique-in-neo4j">deprecated</a>.</li>
</ul>
<h1 id="cycli">cycli</h1>
<p><a href="https://github.com/nicolewhite/cycli">cycli</a> is a command-line interface for Neo4j.</p>
<pre class="shell"><code>$ pip install cycli
$ cycli -f FILENAME  (Execute semicolon-separated Cypher queries)
</code></pre>
<h1 id="cheat-sheet">Cheat sheet</h1>
<h2 id="basics">Basics</h2>
<pre class="cypher"><code>(a:User)--&gt;(b)
(a:User:Admin)--&gt;(b)
(a { name: &quot;Andres&quot;, sport: &quot;Brazilian Ju-Jitsu&quot; })
(a)-[{blocked: false}]-&gt;(b)
(a)--(b)
(a)-[r]-&gt;(b)
(a)-[r:REL_TYPE]-&gt;(b)
(a)-[r:TYPE1|TYPE2]-&gt;(b)
(a)-[:REL_TYPE]-&gt;(b)
(a)-[*2]-&gt;(b)
(a)-[*3..5]-&gt;(b)
(a)-[*3..]-&gt;(b)
(a)-[*..5]-&gt;(b)
(a)-[*]-&gt;(b)
(a)-[:REL_TYPE*1..2]-&gt;(b)
</code></pre>
<h2 id="create-merge-delete">CREATE, MERGE, DELETE</h2>
<pre class="cypher"><code>CREATE (n:Person { name : &#39;Andres&#39;, title : &#39;Developer&#39; })

MATCH (a:Person),(b:Person)
WHERE a.name = &#39;Node A&#39; AND b.name = &#39;Node B&#39;
CREATE (a)-[r:RELTYPE]-&gt;(b)
RETURN r

// MATCH or CREATE if not exists
MERGE (charlie { name:&#39;Charlie Sheen&#39;, age:10 })
RETURN charlie

// Either everything matches or everything is created
MATCH (oliver:Person { name:&#39;Oliver Stone&#39; }),(reiner:Person { name:&#39;Rob Reiner&#39; })
MERGE (oliver)-[:DIRECTED]-&gt;(movie:Movie)&lt;-[:ACTED_IN]-(reiner)
RETURN movie

MATCH (person:Person)
MERGE (city:City { name: person.bornIn })
MERGE (person)-[r:BORN_IN]-&gt;(city)
RETURN person.name, person.bornIn, city

MATCH (n:Useless)
DELETE n

// Delete all notes and relationships
MATCH (n)
DETACH DELETE n
</code></pre>
<h2 id="set-remove-foreach">SET, REMOVE, FOREACH</h2>
<pre class="cypher"><code>MATCH (n { name: &#39;Andres&#39; })
SET n.surname = &#39;Taylor&#39;
RETURN n

// equivalent to REMOVE
MATCH (n { name: &#39;Andres&#39; })
SET n.name = NULL RETURN n

MATCH p =(begin)-[*]-&gt;(END )
WHERE begin.name=&#39;A&#39; AND END .name=&#39;D&#39;
FOREACH (n IN nodes(p)| SET n.marked = TRUE )
</code></pre>
<h2 id="indexes-and-constraints">Indexes and constraints</h2>
<pre class="cypher"><code>CREATE INDEX ON :Person(name)

MATCH (person:Person { name: &#39;Andres&#39; })
RETURN person

DROP INDEX ON :Person(name)

CREATE CONSTRAINT ON (n:Person) ASSERT n.name IS UNIQUE;
</code></pre>
<h2 id="where">WHERE</h2>
<pre class="cypher"><code>WHERE n:Swedish
WHERE exists(n.belt)
WHERE person.belt IS NULL
WHERE n.name STARTS WITH &#39;Pet&#39;
WHERE n.name ENDS WITH &#39;ter&#39;
WHERE n.name CONTAINS &#39;ete&#39;
WHERE NOT n.name ENDS WITH &#39;s&#39;
WHERE n.name =~ &#39;Tob.*&#39;
WHERE n.address =~ &#39;Sweden\\/Malmo&#39;
WHERE n.name =~ &#39;(?i)ANDR.*&#39;

MATCH (tobias { name: &#39;Tobias&#39; }),(others)
WHERE others.name IN [&#39;Andres&#39;, &#39;Peter&#39;] AND (tobias)&lt;--(others)
RETURN others

WHERE (n)-[:KNOWS]-({ name:&#39;Tobias&#39; })
WHERE n.name=&#39;Andres&#39; AND type(r)=~ &#39;K.*&#39;
</code></pre>
<h2 id="skip-limit">SKIP, LIMIT</h2>
<pre class="cypher"><code>// Return middle two
MATCH (n)
RETURN n
ORDER BY n.name
SKIP 1
LIMIT 2
</code></pre>
<h2 id="others">Others</h2>
<pre class="cypher"><code>MATCH (me:Person)--&gt;(friend:Person)--&gt;(friend_of_friend:Person)
WHERE me.name = &#39;A&#39;
RETURN count(DISTINCT friend_of_friend), count(friend_of_friend)

MATCH (david { name: &quot;David&quot; })--(otherPerson)--&gt;()
WITH otherPerson, count(*) AS foaf
WHERE foaf &gt; 1
RETURN otherPerson

UNWIND[1,2,3] AS x
RETURN x

WITH [1,1,2,2] AS coll UNWIND coll AS x
WITH DISTINCT x
RETURN collect(x) AS SET

MATCH (n:Actor)
RETURN n.name AS name
UNION ALL MATCH (n:Movie)
RETURN n.title AS name
</code></pre>
<h1 id="references">References</h1>
<ul>
<li><a href="https://neo4j.com/docs/developer-manual/current/cypher/#query-function">Functions</a></li>
<li><a href="http://neo4j.com/docs/">Neo4j Documentation</a></li>
<li><a href="https://neo4j.com/docs/developer-manual/current/">Neo4j Developer Manual</a></li>
<li><a href="https://neo4j.com/docs/api/python-driver/current/">Neo4j Bolt Driver for Python</a></li>
</ul>
</body>
</html>
